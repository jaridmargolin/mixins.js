!function(a,b){"function"==typeof define&&define.amd?define(["underscore"],function(c){return a.returnExportsGlobal=b(c)}):"object"==typeof exports?module.exports=b(require("underscore")):a.mixins=b(a.underscore)}(this,function(a){var b,c,d;return b=function(b){var c=a,d=function(a,b){this.Obj=a,this.obj=this.Obj.prototype||this.Obj,this.mixins=b||[],this.collisions={},c.each(this.mixins,this.mixin,this),c.each(this.collisions,this.createComposite,this)};return d.prototype.mixin=function(a){c.each(a,this.merge,this)},d.prototype.merge=function(a,b){b in this.obj&&!a.__mixin||(b in this.obj?c.isFunction(a)?this.mergeFunction(a,b):c.isArray(a)?this.mergeArray(a,b):c.isObject(a)&&this.mergeObject(a,b):this.obj[b]=a)},d.prototype.mergeFunction=function(a,b){var d=this.obj[b]===a,e=c.contains(this.collisions[b],a),f=this.collisions.hasOwnProperty(b);d||e||(this.collisions[b]=f?this.collisions[b]:[this.obj[b]],this.collisions[b].push(a))},d.prototype.mergeArray=function(a,b){"append"===a.__mixin?this.obj[b]=this.obj[b].concat(a):"prepend"===a.__mixin?this.obj[b]=a.concat(this.obj[b]):"union"===a.__mixin&&(this.obj[b]=c.union(this.obj[b],a))},d.prototype.mergeObject=function(a,b){"extend"===a.__mixin?this.obj[b]=c.extend(this.obj[b],a):"defaults"===a.__mixin&&(this.obj[b]=c.defaults(this.obj[b],a))},d.prototype.createComposite=function(a,b){var d=this.obj[b];if("constructor"===b){var e=this.Obj;this.Obj=this.composeFn(a,d),this.Obj.prototype=this.obj,c.extend(this.Obj,e)}else this.obj[b]=this.composeFn(a,d)},d.prototype.composeFn=function(a,b){return function(){var d=c.bind(function(a,b){return c.reduce(a,function(a,c){var d=c.apply(this,b);return"undefined"==typeof d?a:d},void 0,this)},this),e=arguments,f=c.where(a,{__mixin:"before"}),g=d(f.reverse(),e),h=b.apply(this,e),i=c.where(a,{__mixin:"after"}),j=d(i,e);return c.isUndefined(j)?c.isUndefined(h)?c.isUndefined(g)?void 0:g:h:j}},d}({}),d=function(a){var b=function(a,b){return Object.defineProperty(b,"__mixin",{enumerable:!1,writable:!0}),b.__mixin=a,b};return b}({}),c=function(c){var e=a,f=b,g=d;return{Mixer:f,mixin:g,mix:function(a,b){var c=e.chain(arguments).toArray().rest().flatten().value(),d=new this.Mixer(a,c);return d.Obj}}}({})});